--- 
title: 2020杭电多校杂题记录
date: 2020-08-12
categories: [算法竞赛]
tags: 
math: true
---

## CONTEST07-1004 Decision

### Description 

数列 $$x_0 = v_1 + v_2, x_n = (a x_{n-1} + c) \pmod m$$

$$v1, v2$$ 为 $$[0, t]$$ 上的随机整数。问 $$ X_{\|v_1 - v_2\|} \bmod 2$$ 的期望

$$m\le 10^6, 0\le t\le \frac m 2$$
### Solution

一开始想的很数学， 因为这个 $$x_{\|v_1-v_2\|}$$ 好像可以展开一下，变成一个只有最高次和 $$x_0$$ 有关的多项式。

但是因为 $$\bmod m$$ 有可能导致奇偶性翻转，然后统计的时候就变成要统计 $$t \bmod m < c, \frac t m \equiv 1/0 \pmod 2$$ 这样的 $$t$$，看起来就不是很能做，卡了很久。

两点的时候发现如果 $$x\to (xa+c) \bmod m$$ 连边，由于每个点的出度都是 $$1$$，会得到一个 $$m$$ 个点的基环内向树，如果 $$a\bot m$$ 就变成了一堆环，那枚举 $$x_0$$ 就变成了枚举起点，要求走 $$\|v_1 - v_2\|$$ 步之后是个奇点，那么这是就有了 $$\|v_1 - v_2\|$$ 的奇偶性和上界，整个倍增就好了。。

## CONTEST07-1005 Expectation

### Description

数轴上 $$2n+1$$ 个位置 $$x_1 \ldots x_{2n+1}$$，奇数位置上是洞，偶数位置上是球。

每次随机选择一个球，再随机选择一个方向滚动，直到掉入洞中，问所有球都掉到洞中的总滚动路程的期望。

$$T\le 2000, n\le 3000$$

### Solution

因为没法 $$Tn^2$$，要想办法把和坐标无关的量剥离出来先算。观察这个过程会发现无论何时相对位置都是 $$\circ-\bullet-\circ-\bullet-\circ$$这样的。

那就设 $$f(i,j)$$ 为 $$i$$ 个球直到消完，第 $$j$$ 段被滚过的期望次数，那么 $$i$$ 个球时一定有 $$2i$$ 段，操作转化成了选一对 $$\circ-\bullet$$ 或者 $$\bullet-\circ$$ 干掉，也就是干掉一段，那么第 $$j$$ 段就有可能变成 $$j-2,j-1,j$$ 段，讨论一下转移即可，具体方程是 $$f(i,j)=\frac{l-1}{2i} f(i-1,j-2) + \frac{r}{2i} f(i-1,j) +  \frac{1}{2i} (1 + [j\ne 1 \operatorname{and} j\ne 2n]f(i-1,j-1))$$。其中 $$l=j-1, r=2i-l$$

答案就是 $$\sum \mathrm{d} x_i * f(n,i)$$，时间复杂度 $$O(n(n+T))$$

## CONTEST07-1008 Hearts

### Description

$$n$$ 个数，每个数有 $$(p_i, b_i)$$，一个集合 $$S$$ 的价值定义为 $$S$$ 中所有 $$p_i$$ 的乘积，要求选出的 $$S$$ 中 $$b_i$$ 互不相交。对每个 $A$ 求出 $$A=\cup_{u\in S}b_u$$ 的所有 $$S$$ 的价值和

$$n\le 10^6, b_i\le 2^m, m=21$$

### Solution

要求的是一个形同 $$x^{b_i} + x^{\emptyset}$$ 的集合幂级数的子集卷积。

普通的子集卷积问题，即 $$c_u = \sum_{x\cup y=u, x\cap y=\emptyset} a_x b_y$$

我们采用 FMT + 占位多项式的策略解决，在 FMT 时每个元素记一个多项式，$$i$$ 次项系数对应着选出 $$\operatorname{popcount} (x) = i$$ 的价值和。

那么现在我们要对 $$n$$ 个这样的集合做连乘，FMT 后对每一个占位多项式做类似多项式 exp 的操作即可，总复杂度 $$O(2^m*m^2)$$。

## CONTEST04-1009 Imperative Meeting

### Description

$$n$$ 个点的无根树。选出 $$m$$ 个点，并在 $$m$$ 中选择一个集合点，记代价为其余 $$m-1$$ 个点走到集合点的距离和。问所有方案的价值和。

$$n\le 10^6$$

### Solution

对每条边考虑贡献，假设他分成的两个连通块中分别选择了 $$i$$ 和 $$m-i$$ 个点，那么这条边就会被经过 $$\min (i, n-i)$$ 次，故总代价为 $$\sum_{i=0}^a \min(i,n-i) {a\choose i}{n-a\choose m - i}$$

把 $$\min$$ 拿掉，考虑前一半，$$\sum_{i=0}^{\frac m 2} i {a\choose i}{n-a\choose m - i}$$，$$i{a\choose i}$$ 可以视作是先选一个代表，再在剩下的 $$a-1$$ 个中选 $$i-1$$ 个，那就变成了 $$a\sum_{i=0}^{\frac m 2} {a-1\choose i-1}{n-a\choose m - i}$$


给上式中的 $$\sum $$ 赋予一个组合意义，在 $$n-1$$ 个中选择 $$m-1$$ 个，前 $$a-1$$ 个中被选择的不能超过 $$\frac m 2$$ 个的方案数。为了对所有的 $$a$$ 求，考虑计算 $$a\to a+1$$ 时新增的非法方案数，一定选了第 $$a$$ 个，前一半选了恰好 $$\frac m 2 - 1$$ 个。当 $$a=0$$ 时，$${n-1\choose m-1}$$ 种方案都是合法的，每次扣掉一些非法方案即可。时间复杂度 $$O(n)$$